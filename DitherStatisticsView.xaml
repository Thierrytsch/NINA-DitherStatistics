<UserControl x:Class="DitherStatistics.Plugin.DitherStatisticsView"
             xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
             xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
             xmlns:mc="http://schemas.openxmlformats.org/markup-compatibility/2006" 
             xmlns:d="http://schemas.microsoft.com/expression/blend/2008" 
             xmlns:lvc="clr-namespace:LiveCharts.Wpf;assembly=LiveCharts.Wpf"
             mc:Ignorable="d" 
             d:DesignHeight="700" d:DesignWidth="400">

    <Grid Background="#1E1E1E">
        <ScrollViewer VerticalScrollBarVisibility="Auto">
            <StackPanel Margin="10">

                <!-- Pixel Shift Chart (60% - larger) -->
                <Border Background="#2D2D30" 
                       BorderBrush="#3E3E42" 
                       BorderThickness="1" 
                       Padding="10" 
                       Margin="0,0,0,10">
                    <StackPanel>
                        <TextBlock Text="Pixel Shift" 
                                  FontSize="14" 
                                  FontWeight="SemiBold" 
                                  Foreground="White"
                                  Margin="0,0,0,10"/>

                        <lvc:CartesianChart Height="300" 
                                          Series="{Binding PixelShiftSeriesCollection}"
                                          LegendLocation="None"
                                          Background="Transparent"
                                          Hoverable="True">

                            <!-- OPTIMIERTER TOOLTIP - GUT SICHTBAR -->
                            <lvc:CartesianChart.DataTooltip>
                                <lvc:DefaultTooltip Background="#2D2D30" 
                                                   Foreground="White"
                                                   BorderBrush="#00A0FF"
                                                   BorderThickness="2"
                                                   FontSize="13"
                                                   FontWeight="SemiBold"
                                                   Padding="8,6"/>
                            </lvc:CartesianChart.DataTooltip>

                            <lvc:CartesianChart.AxisX>
                                <lvc:Axis Title="X Pixels" 
                                        Foreground="White"
                                        LabelFormatter="{Binding XFormatter}">
                                    <lvc:Axis.Separator>
                                        <lvc:Separator Step="1" StrokeThickness="1" Stroke="#3E3E42"/>
                                    </lvc:Axis.Separator>
                                    <lvc:Axis.Sections>
                                        <lvc:AxisSection Value="0" 
                                                        StrokeThickness="3" 
                                                        Stroke="White"/>
                                    </lvc:Axis.Sections>
                                </lvc:Axis>
                            </lvc:CartesianChart.AxisX>
                            <lvc:CartesianChart.AxisY>
                                <lvc:Axis Title="Y Pixels" 
                                        Foreground="White"
                                        LabelFormatter="{Binding YFormatter}">
                                    <lvc:Axis.Separator>
                                        <lvc:Separator Step="1" StrokeThickness="1" Stroke="#3E3E42"/>
                                    </lvc:Axis.Separator>
                                    <lvc:Axis.Sections>
                                        <lvc:AxisSection Value="0" 
                                                        StrokeThickness="3" 
                                                        Stroke="White"/>
                                    </lvc:Axis.Sections>
                                </lvc:Axis>
                            </lvc:CartesianChart.AxisY>
                            <lvc:CartesianChart.ChartLegend>
                                <lvc:DefaultLegend Visibility="Collapsed"/>
                            </lvc:CartesianChart.ChartLegend>
                        </lvc:CartesianChart>
                    </StackPanel>
                </Border>

                <!-- Settle Time Chart (30% - smaller) -->
                <Border Background="#2D2D30" 
                       BorderBrush="#3E3E42" 
                       BorderThickness="1" 
                       Padding="10" 
                       Margin="0,0,0,10">
                    <StackPanel>
                        <TextBlock Text="Settle Time History" 
                                  FontSize="14" 
                                  FontWeight="SemiBold" 
                                  Foreground="White"
                                  Margin="0,0,0,10"/>

                        <lvc:CartesianChart Height="150" 
                                          Series="{Binding SettleTimeSeriesCollection}"
                                          LegendLocation="Bottom"
                                          Background="Transparent"
                                          Hoverable="True">

                            <!-- OPTIMIERTER TOOLTIP - GUT SICHTBAR -->
                            <lvc:CartesianChart.DataTooltip>
                                <lvc:DefaultTooltip Background="#2D2D30" 
                                                   Foreground="White"
                                                   BorderBrush="#1E90FF"
                                                   BorderThickness="2"
                                                   FontSize="13"
                                                   FontWeight="SemiBold"
                                                   Padding="8,6"/>
                            </lvc:CartesianChart.DataTooltip>

                            <lvc:CartesianChart.AxisX>
                                <lvc:Axis Title="Dither #" 
                                        Foreground="White"
                                        MinValue="0">
                                    <lvc:Axis.Separator>
                                        <lvc:Separator Visibility="Hidden"/>
                                    </lvc:Axis.Separator>
                                </lvc:Axis>
                            </lvc:CartesianChart.AxisX>
                            <lvc:CartesianChart.AxisY>
                                <lvc:Axis Title="Settle Time (s)" 
                                        Foreground="White"
                                        LabelFormatter="{Binding SettleTimeFormatter}"
                                        MinValue="0">
                                    <lvc:Axis.Separator>
                                        <lvc:Separator StrokeThickness="1" Stroke="#3E3E42"/>
                                    </lvc:Axis.Separator>
                                </lvc:Axis>
                            </lvc:CartesianChart.AxisY>
                        </lvc:CartesianChart>
                    </StackPanel>
                </Border>

                <!-- Statistics Panel (Simplified) -->
                <Border Background="#2D2D30" 
                       BorderBrush="#3E3E42" 
                       BorderThickness="1" 
                       Padding="15" 
                       Margin="0,0,0,10">
                    <StackPanel>
                        <TextBlock Text="Statistics" 
                                  FontSize="14" 
                                  FontWeight="SemiBold" 
                                  Foreground="White"
                                  Margin="0,0,0,10"/>

                        <Grid>
                            <Grid.ColumnDefinitions>
                                <ColumnDefinition Width="*"/>
                                <ColumnDefinition Width="Auto"/>
                            </Grid.ColumnDefinitions>
                            <Grid.RowDefinitions>
                                <RowDefinition Height="Auto"/>
                                <RowDefinition Height="Auto"/>
                                <RowDefinition Height="Auto"/>
                            </Grid.RowDefinitions>

                            <!-- Combined: Total / Success / Success Rate -->
                            <TextBlock Grid.Row="0" Grid.Column="0" 
                                      Text="Dithers:" 
                                      Foreground="#B0B0B0"
                                      Margin="0,3"/>
                            <TextBlock Grid.Row="0" Grid.Column="1" 
                                      Foreground="White"
                                      FontWeight="Bold" 
                                      Margin="10,3,0,3">
                                <TextBlock.Text>
                                    <MultiBinding StringFormat="{}{0} / {1} / {2:F1}% (Total/Success/Rate)">
                                        <Binding Path="TotalDithers"/>
                                        <Binding Path="SuccessfulDithers"/>
                                        <Binding Path="SuccessRate"/>
                                    </MultiBinding>
                                </TextBlock.Text>
                            </TextBlock>

                            <!-- Median -->
                            <TextBlock Grid.Row="1" Grid.Column="0" 
                                      Text="Median Settle:" 
                                      Foreground="#B0B0B0"
                                      Margin="0,3"/>
                            <TextBlock Grid.Row="1" Grid.Column="1" 
                                      Foreground="White"
                                      FontWeight="Bold" 
                                      Margin="10,3,0,3">
                                <TextBlock.Text>
                                    <MultiBinding StringFormat="{}{0:F2}s">
                                        <Binding Path="MedianSettleTime"/>
                                    </MultiBinding>
                                </TextBlock.Text>
                            </TextBlock>

                            <!-- Min/Max -->
                            <TextBlock Grid.Row="2" Grid.Column="0" 
                                      Text="Min / Max:" 
                                      Foreground="#B0B0B0"
                                      Margin="0,3"/>
                            <TextBlock Grid.Row="2" Grid.Column="1" 
                                      Foreground="White"
                                      FontWeight="Bold" 
                                      Margin="10,3,0,3">
                                <TextBlock.Text>
                                    <MultiBinding StringFormat="{}{0:F2}s / {1:F2}s">
                                        <Binding Path="MinSettleTime"/>
                                        <Binding Path="MaxSettleTime"/>
                                    </MultiBinding>
                                </TextBlock.Text>
                            </TextBlock>

                        </Grid>
                    </StackPanel>
                </Border>

                <!-- Action Buttons -->
                <Border Background="#2D2D30" 
                       BorderBrush="#3E3E42" 
                       BorderThickness="1" 
                       Padding="10">
                    <StackPanel>
                        <TextBlock Text="Actions" 
                                  FontSize="14" 
                                  FontWeight="SemiBold" 
                                  Foreground="White"
                                  Margin="0,0,0,10"/>

                        <UniformGrid Columns="1" Rows="2">
                            <Button Content="Clear Data" 
                                   Command="{Binding ClearDataCommand}" 
                                   Background="#3E3E42"
                                   Foreground="White"
                                   Padding="10,8"
                                   Margin="0,0,0,5"
                                   BorderThickness="0"
                                   Cursor="Hand"/>

                            <Button Content="Export CSV" 
                                   Command="{Binding ExportDataCommand}" 
                                   Background="#3E3E42"
                                   Foreground="White"
                                   Padding="10,8"
                                   BorderThickness="0"
                                   Cursor="Hand"/>
                        </UniformGrid>
                    </StackPanel>
                </Border>

            </StackPanel>
        </ScrollViewer>
    </Grid>
</UserControl>
